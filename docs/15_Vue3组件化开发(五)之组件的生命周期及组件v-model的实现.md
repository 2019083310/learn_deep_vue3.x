# Vue3组件化之组件的生命周期及组件v-model的实现

### $refs的使用

某些情况下，我们在组件中想要**直接获取到元素对象或者子组件实例**： 

- 在Vue开发中我们是不推荐进行DOM操作的；
- 这个时候，我们可以给元素或者组件绑定一个ref的attribute属性； 

**组件实例有一个$refs属性：**

- 它一个对象Object，持有注册过 ref attribute 的所有 DOM 元素和组件实例。

![image-20220211120340452](D:\截图\03_vue3组件化\image-20220211120340452.png)



### $parent和$root

**我们可以通过$parent来访问父元素。**

HelloWorld.vue的实现：这里我们也可以通过$root来实现，因为App是我们的根组件；

![image-20220211120441637](D:\截图\03_vue3组件化\image-20220211120441637.png)

注意：在Vue3中已经**移除了$children的属性**，所以不可以使用了。



### 认识生命周期

**什么是生命周期呢？**

- 每个组件都可能会经历从创建、挂载、更新、卸载等一系列的过程； 

- 在这个过程中的某一个阶段，用于可能会想要添加一些属于自己的代码逻辑（比如组件创建完后就请求一些服

  务器数据）；

- 但是我们如何可以知道目前组件正在哪一个过程呢？Vue给我们提供了组件的生命周期函数； 

**生命周期函数：**

- 生命周期函数是一些钩子函数，在某个时间会被Vue源码内部进行回调； 
- 通过对生命周期函数的回调，我们可以知道目前组件正在经历什么阶段； 
- 那么我们就可以在该生命周期中编写属于自己的逻辑代码了；



### 生命周期的流程

![image-20220211122010973](D:\截图\03_vue3组件化\image-20220211122010973.png)



### 缓存组件的生命周期

对于缓存的组件来说，再次进入时，我们是**不会执行created或者mounted等生命周期函数**的：

- 但是有时候我们确实希望监听到何时重新进入到了组件，何时离开了组件；
- 这个时候我们可以使用activated 和 deactivated 这两个生命周期钩子函数来监听；

![image-20220211123126101](D:\截图\03_vue3组件化\image-20220211123126101.png)



### 组件的v-model

**前面我们在input中可以使用v-model来完成双向绑定**：

- 这个时候往往会非常方便，因为v-model默认帮助我们完成了两件事；
- v-bind:value的数据绑定和@input的事件监听； 

如果我们现在**封装了一个组件**，其他地方在使用这个组件时，是否也可以**使用v-model来同时完成这两个功能**呢？

- 也是可以的，vue也支持在组件上使用v-model； 

**当我们在组件上使用的时候，等价于如下的操作：**

- 我们会发现和input元素不同的只是属性的名称和事件触发的名称而已；

![image-20220211123324625](D:\截图\03_vue3组件化\image-20220211123324625.png)



### 组件v-model的实现

**那么，为了我们的MyInput组件可以正常的工作，这个组件内的 input 必须：**

- 将其 value attribute 绑定到一个名叫 modelValue 的 prop 上；
- 在其 input 事件被触发时，将新的值通过自定义的 update:modelValue 事件抛出；

MyInput.vue的组件代码如下：

![image-20220211123439795](D:\截图\03_vue3组件化\image-20220211123439795.png)



### computed实现

我们依然希望在组件内部按照双向绑定的做法去完成，应该如何操作呢？**我们可以使用计算属性的setter和getter来完成。**

![image-20220211123530457](D:\截图\03_vue3组件化\image-20220211123530457.png)



### 绑定多个属性

我们现在通过v-model是直接绑定了一个属性，如果我们**希望绑定多个属性**呢？ 

- 也就是我们希望在一个组件上使用多个v-model是否可以实现呢？
- 我们知道，默认情况下的v-model其实是绑定了 modelValue 属性和 @update:modelValue的事件；
- 如果我们希望绑定更多，可以给v-model传入一个参数，那么这个参数的名称就是我们绑定属性的名称； 

注意：这里我是绑定了两个属性的 

![image-20220211123632335](D:\截图\03_vue3组件化\image-20220211123632335.png)

**v-model:title相当于做了两件事：**

- 绑定了title属性； 
- 监听了 @update:title的事件；

![image-20220211123616418](D:\截图\03_vue3组件化\image-20220211123616418.png)